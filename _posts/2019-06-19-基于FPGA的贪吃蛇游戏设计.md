---
layout:     post
title:      基于FPGA的贪吃蛇游戏设计
subtitle:   
date:       2019-06-19
author:     yzmb2411
header-img: 
catalog: 	 true
tags:
    - FPGA
    - 图像处理  
---

最近在做学校的电子设计比赛，做了一个基于FPGA的贪吃蛇小游戏，写一篇博客来记录一下自己的创作过程。大部分的内容直接采用了设计报告的原话。

对于重点：蛇身控制部分，我开始的想法是将每个格子的坐标输入到存储器中，但由于过于繁琐和笨拙，我改为：只控制蛇头，其他部位随头联动，完成了最终设计。

##  摘要 
贪吃蛇是一个简单而大众的游戏，它因操作简单、娱乐性强而广受欢迎。本文以贪吃蛇游戏的开发为例，着重阐述了基于FPGA平台的游戏开发技术和方法，为后续基于FPGA平台的游戏开发打下良好的基础。整个游戏的开发基于FPGA硬件平台和ISE开发环境，游戏的开发中贯穿IP重用的思想，借鉴并重用了已经成熟的VGA显示模块和ROM IP核，专注于游戏的核心控制部分的实现。

## 作品构思

随着社会的发展，游戏的易携性越来越受到人们的关注，基于嵌入式平台的游戏设计迅速崛起。为适应游戏玩家的消费需求，国内外厂家纷纷推出自己的游戏产品，索尼的P2P系列、任天堂最新推出的Wii，还有微软的Xbox，但是他们均无一例外的遭遇到了被破解的命运。现在游戏对硬件平台的要求已经越来越高，但是硬件的更新换代始终没能绕开被破解盗版的命运。因此，对游戏机平台的技术升级更新的需要非常迫切。FPGA因其高速度、高精度等功能特性，被越来越多的游戏开发者所接受。采用带有加密功能的FPGA芯片实现游戏机平台，往往可以有效防止电脑黑客对游戏控制台的破解。

贪吃蛇是手机中或电脑中很常见的一个经典小游戏，在紧张的现实生活中给人们带来了不少的乐趣，能让人们在业余时间里适当的放松，并保持好的心态。   

本文采用FPGA技术，直接使用Verilog语言编写了一个贪吃蛇游戏。目的在于阐述在FPGA平台上开发游戏的思路、流程和方法。

## 作品实现流程

使用Xilinx公司的Spartan6系列XC6SLX16芯片作为游戏平台的控制核心，采用HDL硬件描述语言在FPGA芯片上实现对整个游戏的全程控制。本次设计使用FPGA来驱动VGA实现贪吃蛇游戏，玩家可通过4个按键控制贪吃蛇不断地吞食屏幕上随机出现的苹果，贪食蛇的长度也随之加长，8段数码管实时显示玩家得分。 

下图为系统核心功能模块划分
![image](https://wx2.sinaimg.cn/mw1024/ab20a024gy1g45798a2dbj20ho07lglq.jpg)

下图为游戏流程图
![image](https://wx4.sinaimg.cn/mw1024/ab20a024gy1g45798ctpnj20he0g8aap.jpg)

## 作品具体功能

本文使用FPGA来驱动VGA实现贪吃蛇游戏，玩家可通过4个按键控制贪吃蛇不断地吞食屏幕上随机出现的苹果，贪食蛇的长度也随之加长，8段数码管实时显示玩家得分。

系统分为顶层模块、VGA显示模块、蛇身控制模块、苹果产生模块。游戏主控制模块、按键检测模块、数码管显示模块、顶层模块是与FPGA开发板之间的硬件管脚接口，并且控制其他模块有条不紊地运行。

下面对主要模块进行简单说明。

### 游戏主控制模块 
本模块对游戏的3种状态进行描述，分别是start(起始界面)、play(游戏界面)、end(结束界面)。并给出了游戏状态相互转换的条件。

![image](https://wxt.sinaimg.cn/mw1024/ab20a024ly1g458s55rzaj20bl09pmxl.jpg?tags=%5B%5D)

### 苹果产生模块 
苹果产生模块的主要任务有两个：
 - 将苹果显示输出给VGA显示模块
 - 蛇吃到苹果，即蛇头坐标与苹果坐标相等，蛇身长度加一，苹果位置重置。
 
![image](https://wx1.sinaimg.cn/mw1024/ab20a024ly1g458s57o8oj20fh09hwf7.jpg)

### 蛇身控制模块 

蛇身控制模块是整个游戏最核心的部分，我们通过操控蛇头的位置来实现对整个蛇身位置的控制，当四个方向键有任意一个按键按下时，如果不是与当前反向或同向，则蛇头坐标实现对应的移动。蛇头移动方向后，将蛇头的位置赋值给后一个方格点，以此类推实现整个蛇身的移动。还有一个重要的数据就是蛇的死亡判定，有二种判定方法：撞墙或撞到了自己，发生这种情况时输出到游戏控制模块中，游戏结束。

![image](https://wx2.sinaimg.cn/mw1024/ab20a024ly1g458s5aoedj20fd0but9v.jpg)

### VGA显示模块 

VGA显示模块负责VGA显示器的接口处理，将游戏需要显示的信息正常显示在VGA显示器上。该模块显示贪吃蛇的蛇头和蛇身、苹果、蛇的移动等基本信息，以及当前蛇的长度。

![image](https://wx1.sinaimg.cn/mw1024/ab20a024ly1g458s564c1j20dv09rdgj.jpg)

### 按键检测模块 

按键检测模块负责读取按键信息。该模块不停扫描标准按键，当有按键按下时，获取该按键的信息，并根据该按键被赋予的功能控制贪吃蛇的上、下、左、右四个方向的移动，控制游戏复位等。

![image](https://wx2.sinaimg.cn/mw1024/ab20a024ly1g458s567k7j20fz0c8t9f.jpg)

### 数码管显示模块 

数码管显示模块负责显示当前获得的分数

![image](https://wx1.sinaimg.cn/mw1024/ab20a024ly1g458s57c9sj20is06vt96.jpg)

至此，简单的贪吃蛇游戏就完成了，后期还可以加入新功能，例如UI的优化，难易度调节等。 

## 作品代码
代码部分详见Github